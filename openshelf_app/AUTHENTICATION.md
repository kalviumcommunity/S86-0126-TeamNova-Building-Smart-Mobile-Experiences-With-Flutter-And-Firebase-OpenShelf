# Firebase Authentication (Email & Password) — OpenShelf

This document describes how Email & Password authentication is implemented in the OpenShelf Flutter app using Firebase Authentication.

## Project Summary

OpenShelf uses Firebase Auth to handle user signup, login, session state, and logout without a custom backend. The app includes:
- `lib/services/auth_service.dart` — wrapper around `firebase_auth` with `signUp`, `login`, and `logout` methods.
- `lib/screens/login_screen.dart` and `lib/screens/signup_screen.dart` — UI screens for authentication flows.
- `lib/screens/auth_gate.dart` — listens to `authStateChanges()` and routes users to `WelcomeScreen` when signed in or `LoginScreen` when signed out.

## Enable Email/Password in Firebase Console

1. Open your Firebase Console → your project → Authentication → Sign-in method.
2. Enable **Email/Password** and save.

## Dependencies

Add these to `pubspec.yaml` (already present in this project):

```yaml
firebase_core: ^3.0.0
firebase_auth: ^5.0.0
```

Run:

```bash
flutter pub get
```

## Firebase Initialization

Ensure Firebase is initialized before using auth APIs. `lib/main.dart` already initializes Firebase using `firebase_options.dart` (generated by `flutterfire`):

```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  runApp(const MyApp());
}
```

## Key Code Snippets

Auth wrapper (`lib/services/auth_service.dart`):

```dart
final FirebaseAuth _auth = FirebaseAuth.instance;

Future<User?> signUp(String email, String password) async {
  UserCredential credential = await _auth.createUserWithEmailAndPassword(
    email: email,
    password: password,
  );
  return credential.user;
}

Future<User?> login(String email, String password) async {
  UserCredential credential = await _auth.signInWithEmailAndPassword(
    email: email,
    password: password,
  );
  return credential.user;
}

Future<void> logout() async {
  await _auth.signOut();
}
```

Auth state listener (`lib/screens/auth_gate.dart`):

```dart
StreamBuilder<User?>(
  stream: FirebaseAuth.instance.authStateChanges(),
  builder: (context, snapshot) {
    if (snapshot.connectionState == ConnectionState.waiting) {
      return const Scaffold(body: Center(child: CircularProgressIndicator()));
    }
    final user = snapshot.data;
    return user != null ? const WelcomeScreen() : const LoginScreen();
  },
)
```

Usage in UI screens:
- `login_screen.dart` and `signup_screen.dart` call the `AuthService.login` and `AuthService.signUp` methods and show feedback via `SnackBar` and navigation.

Logout example (added to `ProfileScreen`):

```dart
await AuthService().logout();
Navigator.pushReplacementNamed(context, '/login');
```

## Verify Users

After signing up, check Firebase Console → Authentication → Users to see registered emails.

## Common Issues

- Invalid email format: ensure proper email pattern.
- Password must be 6+ characters: enforce on client or show error returned by Firebase.
- Firebase not initialized: ensure `Firebase.initializeApp()` is awaited in `main()`.

## Screenshot

Add a screenshot of the Firebase Console (Authentication → Users) to `assets/images/` and reference it here for the project submission.

## Reflection Questions

- How does Firebase simplify authentication management?
  - Firebase provides hosted, secure auth flows, built-in providers, token management, and integration with other Firebase products (Firestore, Functions). It reduces backend work and security complexity.

- What security features make Firebase better than rolling your own?
  - Secure token handling (ID tokens), enforced password rules, provider verification, account recovery, monitoring and built-in protections against common auth attacks.

- Challenges faced implementing these flows:
  - Handling asynchronous initialization, displaying appropriate loading states, and surfacing FirebaseAuthException messages in a user-friendly way.

---

If you'd like, I can:
- Add automated tests for authentication flows,
- Add a password reset flow,
- Or include a sample screenshot in the repo.
